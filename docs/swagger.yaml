basePath: /
definitions:
  handler.IPControlRequest:
    properties:
      ip:
        example: 192.168.1.10
        type: string
      lan_interface:
        example: eth0
        type: string
      rate_limit:
        example: 5mbit
        type: string
      wan_interface:
        example: wlan1
        type: string
    required:
    - ip
    - lan_interface
    - wan_interface
    type: object
  handler.IPTrafficStat:
    properties:
      download_mbps:
        type: number
      ip:
        type: string
      is_limited:
        type: boolean
      status:
        description: e.g., "Active", "New", "Disconnected"
        type: string
      upload_mbps:
        type: number
    type: object
  handler.InterfaceStats:
    properties:
      current_rate_rx_mbps:
        example: 5.5
        type: number
      current_rate_tx_mbps:
        example: 12.8
        type: number
      interface_name:
        example: eth0
        type: string
      ip_stats:
        additionalProperties:
          $ref: '#/definitions/handler.IPTrafficStat'
        description: Empty for now
        type: object
      total_bytes_rx:
        example: 1100000
        type: integer
      total_bytes_tx:
        example: 2351000
        type: integer
    type: object
  handler.RuleUpdateRequest:
    properties:
      lan_interface:
        example: eth0
        type: string
      latency:
        example: 50ms
        type: string
      rate_limit:
        example: 10mbit
        type: string
      wan_interface:
        example: wlan1
        type: string
    required:
    - lan_interface
    - rate_limit
    - wan_interface
    type: object
  handler.SetupRequest:
    properties:
      lan_interface:
        example: eth0
        type: string
      total_bandwidth:
        example: 10mbit
        type: string
      wan_interface:
        example: wlan1
        type: string
    required:
    - lan_interface
    - total_bandwidth
    - wan_interface
    type: object
host: localhost:8080
info:
  contact: {}
  description: This API manages Quality of Service (QoS) rules using Linux Traffic
    Control (tc).
  title: QoS Traffic Control API
  version: "1.0"
paths:
  /qos/htb/global/limit:
    post:
      consumes:
      - application/json
      description: Changes the rate/ceil of the HTB root class (1:1) on both LAN and
        WAN interfaces.
      parameters:
      - description: Interface and Bandwidth Update
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RuleUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: HTB global limit updated successfully'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to update HTB limit'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Updates the global rate limit for the existing HTB structure.
      tags:
      - HTB Setup
  /qos/ip/limit:
    post:
      consumes:
      - application/json
      description: Adds a child class under the global HTB qdisc and applies a filter
        to match the specified IP address.
      parameters:
      - description: IP and Rate Limit Configuration
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.IPControlRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: IP rate limit applied successfully'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format or missing field'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to apply IP rate limit'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Applies a specific HTB rate limit to a client IP.
      tags:
      - HTB IP Control
  /qos/ip/remove:
    post:
      consumes:
      - application/json
      description: Removes the specific child class and filter associated with the
        IP.
      parameters:
      - description: IP address to remove limit from
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.IPControlRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: IP rate limit removed successfully'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format or missing field'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to remove IP rate limit'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Removes the HTB rate limit applied to a client IP.
      tags:
      - HTB IP Control
  /qos/reset:
    post:
      consumes:
      - application/json
      description: Deletes the root qdisc on both the specified LAN and WAN interfaces,
        effectively removing all HTB or TBF rules.
      parameters:
      - description: Interfaces to reset
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.SetupRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: Shaping successfully reset on both interfaces'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to reset shaping'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Removes all shaping (QDiscs) from both interfaces.
      tags:
      - Cleanup
  /qos/setup:
    post:
      consumes:
      - application/json
      description: Sets up the root HTB qdisc and class 1:1 on both LAN and WAN interfaces.
      parameters:
      - description: Interface and Global Bandwidth Configuration
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.SetupRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: HTB structure successfully initialized'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to set up HTB structure'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Initializes the HTB (Hierarchical Token Bucket) structure.
      tags:
      - HTB Setup
  /qos/simple/limit:
    post:
      consumes:
      - application/json
      description: Applies a simple Token Bucket Filter (TBF) qdisc to the root of
        both LAN and WAN interfaces.
      parameters:
      - description: Interface and Bandwidth/Latency parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RuleUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 'status: Simple TBF rule applied successfully'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 'error: Invalid request format or missing field'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to apply TBF rule'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Applies a simple interface-wide limit using TBF.
      tags:
      - Simple TBF
  /qos/stats:
    get:
      description: Lit les compteurs de /proc/net/dev et calcule le débit (Rx et Tx)
        en Mbps en utilisant l'état précédent stocké côté serveur.
      produces:
      - application/json
      responses:
        "200":
          description: Débit de trafic par interface
          schema:
            $ref: '#/definitions/handler.InterfaceStats'
        "400":
          description: Requête invalide
          schema:
            type: string
        "500":
          description: Erreur lors de la récupération des statistiques
          schema:
            type: string
      summary: Récupère le débit de trafic par interface en une seule fois (polling
        HTTP).
      tags:
      - Monitoring
  /qos/stream:
    get:
      description: Met à niveau la connexion HTTP vers WebSocket et pousse les statistiques
        de débit par IP et globales (issues du QoSManager) toutes les ~2 secondes.
      responses: {}
      summary: Ouvre une connexion WebSocket pour streamer le débit de trafic par
        IP en temps réel.
      tags:
      - Monitoring
  /status/lanips:
    get:
      description: Uses 'ip neighbor show' to find IPs in REACHABLE, STALE, or DELAY
        state on the local network interface.
      parameters:
      - description: The LAN interface name (e.g., eth0)
        in: query
        name: lan_interface
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of connected IPv4 or IPv6 (non-fe80) addresses
          schema:
            items:
              type: string
            type: array
        "400":
          description: 'error: Missing or invalid lan_interface parameter'
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 'error: Failed to execute ip neighbor command'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Retrieves connected client IPs on the LAN interface.
      tags:
      - Status
swagger: "2.0"
